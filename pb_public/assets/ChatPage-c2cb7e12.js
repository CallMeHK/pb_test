import{u as s,o as t,b as c,p as u,_ as h,F as g,c as d,a as p,h as m,d as f,M as v}from"./index-b6294681.js";const x=i=>{const e=i.id===c.value.id;return t("div",{style:e?{display:"flex",flexDirection:"row-reverse",marginLeft:"16px"}:{display:"flex",flexDirection:"row",marginRight:"24px"},children:t("article",{style:{...e?{backgroundColor:"rgb(34 66 31)"}:{backgroundColor:"#182530"},margin:"calc(var(--block-spacing-vertical)/2) 0",padding:"calc(var(--block-spacing-horizontal)/1.5) calc(var(--block-spacing-horizontal)/1.5)"},children:t("p",{children:i.text})})})},y=()=>{const{data:i}=s({skipMountFetch:!0});return t("div",{children:i.map(e=>t(x,{id:e.author,text:e.text},e.id))})},b=({userId:i})=>{const[e,r]=u(""),{create:n}=s({skipMountFetch:!0}),a=h();return t("section",{id:"form",children:t("form",{onSubmit:async l=>{l.preventDefault(),await n({text:e,author:c.value.id,recipient:i}),r(""),a.current.focus()},autocomplete:"off",children:t("input",{type:"text",id:"text",name:"text",placeholder:"",value:e,onInput:l=>r(l.target.value),ref:a})})})},k=()=>{const i=h();return m(()=>i.current.scrollIntoView()),t("div",{ref:i})},C=({user:i})=>{const e=g(()=>({filter:`(author.id="${i.id}" && recipient.id="${c.value.id}") || (author.id="${c.value.id}" && recipient.id="${i.id}")`,sort:"+created",subscription:{event:"*",callback:a=>{a.action==="create"&&(d.value=[...d.value,a.record])}}}),[i.id]),{data:r,loading:n}=s(e);return n?null:t(p,{children:[t("div",{style:{overflowY:"auto",maxHeight:"60vh"},children:[t(y,{}),t(k,{})]}),t(b,{userId:i.id})]})},M=()=>{const{data:i}=f(),[e,r]=u(null);return t("section",{children:i.map(n=>t("details",{open:(e==null?void 0:e.id)===n.id,children:[t("summary",{onClick:a=>{a.preventDefault(),a.stopPropagation(),r(o=>(o==null?void 0:o.id)===n.id?null:n)},children:c.value.id===n.id?`Me (${n.username})`:n.username}),(e==null?void 0:e.id)===n.id&&t(C,{user:n})]},n.id))})},$=()=>t(p,{children:t(v,{children:t(M,{})})});export{$ as ChatPage};
